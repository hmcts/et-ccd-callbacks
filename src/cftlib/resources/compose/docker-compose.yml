---
version: '3.5'

services:
  dm-store:
    image: "${DM_STORE_USE_LOCAL-hmctspublic.azurecr.io/}dm/store:${DM_STORE_TAG:-latest}"
    healthcheck:
      disable: true
    environment:
      SERVER_PORT: 5005
      IDAM_SUPERUSER_EMAIL:
      IDAM_SECRET_KEY: AAAAAAAAAAAAAAAA
      GOV_NOTIFY_API_KEY:
      SPRING_DATASOURCE_URL: jdbc:postgresql://host.docker.internal:6432/evidence
      SPRING_DATASOURCE_USERNAME: "postgres"
      SPRING_DATASOURCE_PASSWORD: "postgres"
      ENABLE_AZURE_STORAGE_CONTAINER: "true"
      ENABLE_POSTGRES_BLOB_STORAGE: "false"
      STORAGEACCOUNT_PRIMARY_CONNECTION_STRING: "DefaultEndpointsProtocol=http;AccountName=devstoreaccount1;AccountKey=Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==;BlobEndpoint=http://azure-storage-emulator-azurite:10000/devstoreaccount1"
      STORAGE_CONTAINER_DOCUMENT_CONTAINER_NAME: "hmctstestcontainer"
      SPRING_PROFILES_ACTIVE: dev
      IDAM_TESTING_SUPPORT_ENABLED: "true"
      LOGGING_LEVEL_UK_GOV_HMCTS_IDAM: WARN
      IDAM_USER_BASE_URI: http://localhost:5000
      IDAM_S2S_BASE_URI: http://host.docker.internal:8489
      S2S_NAMES_WHITELIST: em_gw,em_ccd_orchestrator,ccd,document-management-store,ccd_gw,idam-api,em_stitching_api,ccd_data,dg_docassembly_api,xui_webapp,ccd_case_document_am_api,et_cos,et_msg_handler,et_sya_api
      http_proxy:
      https_proxy:
      no_proxy:
      REFORM_SERVICE_TYPE: java
      REFORM_SERVICE_NAME: document-management-store
      REFORM_TEAM: ccd
      REFORM_ENVIRONMENT: docker
      PACKAGES_ENVIRONMENT: docker
      PACKAGES_PROJECT: evidence
      PACKAGES_NAME: document-management-store
      PACKAGES_VERSION: unknown
      ENABLE_DB_MIGRATE: "true"
    ports:
      - "5005:5005"

  azure-storage-emulator-azurite:
    image: arafato/azurite
    ports:
      - "10000:10000"
    environment:
      executable: "blob"
    volumes:
      - ccd-docker-azure-blob-data:/opt/azurite/folder

  wiremock:
    container_name: wiremock
    image: wiremock/wiremock
    volumes:
      - ./mocks/wiremock:/home/wiremock:rw
    ports:
      - "8765:8080"
    command:
      - -global-response-templating

  manage-case-assignment:
    image: "hmctspublic.azurecr.io/aac/manage-case-assignment:${MANAGE_CASE_ASSIGNMENT_TAG:-latest}"
    container_name: manage-case-assignment
    environment:
      SERVER_PORT: 4454
      IDAM_API_URL: "${IDAM_STUB_SERVICE_NAME:-http://idam-api:5000}"
      IDAM_OIDC_URL: "${IDAM_STUB_SERVICE_NAME:-http://idam-api:5000}"
      S2S_URL: http://service-auth-provider-api:8489
      MANAGE_CASE_S2S_KEY: "AAAAAAAAAAAAAAAA"
      CCD_DATA_STORE_API_BASE_URL: http://ccd-data-store-api:4452
      CCD_DEFINITION_STORE_API_BASE_URL: http://ccd-definition-store-api:4451
      PRD_HOST: http://host.docker.internal:4507
      NOTIFY_MCA_API_KEY: "notify-test-api-key"
      MANAGE_CASE_S2S_AUTHORISED_SERVICES: xui_webapp,ccd_data,ccd_gw,xui_mo_webapp,et_cos
      ROOT_LOGGING_LEVEL: info
      CCD_DATA_STORE_ALLOWED_SERVICE: xui_webapp
      MCA_DS_PROXY_URLS_ALLOWED_LIST: /searchCases.*,/internal/searchCases.*,/internal/cases.*
      MCA_DEF_STORE_PROXY_URLS_ALLOWED_LIST: /api/display/challenge-questions.*
      MCA_CONDITIONAL_APIS_CASE_ASSIGNMENTS_ENABLED: "true"
      ROLE_ASSIGNMENT_URL: "${ROLE_ASSIGNMENT_URL:-http://am-role-assignment-service:4096}"
      IDAM_CAA_USERNAME: "mca.system.idam.acc@gmail.com"
      IDAM_CAA_PASSWORD: "password"
      IDAM_NOC_APPROVER_USERNAME: "mca.noc.approver@gmail.com"
      IDAM_NOC_APPROVER_PASSWORD: "password"
      IDAM_CLIENT_SECRET: "${BEFTA_S2S_CLIENT_SECRET_OF_AAC_MANAGE_CASE_ASSIGNMENT}"
      IDAM_CLIENT_ID: aac_manage_case_assignment
      IDAM_URL: "${IDAM_STUB_SERVICE_NAME:-http://idam-api:5000}"
      CCD_DEFINITION_STORE_ALLOWED_SERVICE: xui_webapp
    ports:
      - "4454:4454"

volumes:
  ccd-docker-azure-blob-data:

networks:
  default:
    name: cftlib_default
    external: true
